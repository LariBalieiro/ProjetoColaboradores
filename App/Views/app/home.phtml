<?php include("_nav.phtml"); ?>

<link rel="stylesheet" href="css/styleHome.css">

<div class="container spacer-top">
    <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="holerite-tab" data-bs-toggle="tab" data-bs-target="#holerite-tab-pane" type="button" role="tab" aria-controls="holerite-tab-pane" aria-selected="true">Holerite</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="ponto-tab" data-bs-toggle="tab" data-bs-target="#ponto-tab-pane" type="button" role="tab" aria-controls="ponto-tab-pane" aria-selected="false">Ponto</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" 
                id="comissao-tab" 
                data-bs-toggle="tab" 
                data-bs-target="#comissao-tab-pane" 
                type="button" 
                role="tab" 
                aria-controls="comissao-tab-pane" 
                aria-selected="false"
                <?= $this->view->isVendedor ? '' : 'style="display:none;"' ?>>
                Comissão
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="informederendimento-tab" data-bs-toggle="tab" data-bs-target="#informederendimento-tab-pane" type="button" role="tab" aria-controls="informederendimento-tab-pane" aria-selected="false">Informe de Rendimentos</button>
        </li>
    </ul>

    <div class="tab-content" id="myTabContent">

        <!-- HOLERITES -->
        <div class="tab-pane fade show active" id="holerite-tab-pane" role="tabpanel" aria-labelledby="holerite-tab" tabindex="0">
            <div class="row">
                <div class="col">
                    <div class="table-responsive tableFixHead mb-3" id="table-scroll-holerite">
                        <table class="table table-sm table-bordered mb-0" id="TabelaHolerites">
                            <thead class="text-center">
                                <tr class="bg-dark text-white">
                                    <th scope="col">Situação</th>
                                    <th scope="col">Data</th>
                                    <th scope="col">Download</th>
                                </tr>
                            </thead>
                            <tbody>
                                <?php if (!empty($this->view->holerites)): ?>
                                    <?php foreach ($this->view->holerites as $holerite): ?>
                                        <tr>
                                            <td class="text-center">
                                                <span class="<?= $holerite['Holerite_Lido'] ? 'text-success' : 'text-danger' ?>">
                                                    <?= $holerite['Holerite_Lido'] ? 'Visualizado' : 'Não visualizado' ?>
                                                </span>
                                            </td>
                                            <td class="text-center"><?= $holerite['Holerite_Data'] ?></td>
                                            <td class="text-center">
                                                <a href="/PDF/holerite/<?= $holerite['Holerite_PDF'] ?>.pdf"
                                                    class="btn btn-primary btn-sm" target="_blank">
                                                    <i class="bi bi-download"></i> Download
                                                </a>
                                            </td>
                                        </tr>
                                    <?php endforeach; ?>
                                <?php else: ?>
                                    <tr>
                                        <td colspan="3" class="text-center text-danger">Nenhum holerite chegou na view!</td>
                                    </tr>
                                <?php endif; ?>
                            </tbody>
                        </table>
                    </div>

                    <!-- Paginação Holerite -->
                    <div class="d-flex justify-content-between align-items-center flex-wrap">
                        <div>
                            <small>Página <?= $this->view->paginaHolerite ?> de <?= $this->view->totalPaginasHolerite ?></small>
                        </div>

                        <div class="form-group mb-2">
                            <select class="form-control" onchange="mudaPaginaHolerite(this.value)">
                                <?php for($i = 1; $i <= $this->view->totalPaginasHolerite; $i++): ?>
                                    <option value="<?= $i ?>" <?= $i == $this->view->paginaHolerite ? 'selected' : '' ?>>
                                        <?= $i ?>
                                    </option>
                                <?php endfor; ?>
                            </select>
                        </div>

                        <div class="btn-group mb-2" role="group">
                            <a onclick="alteraPaginaHolerite('inicio')" class="btn btn-outline-danger" title="Primeira Página">
                                <i class="fas fa-step-backward"></i>
                            </a>
                            <a onclick="alteraPaginaHolerite(-1)" class="btn btn-outline-primary" title="Página Anterior">
                                <i class="fas fa-angle-left"></i> Anterior
                            </a>
                            <a onclick="alteraPaginaHolerite(1)" class="btn btn-outline-primary" title="Próxima Página">
                                Próximo <i class="fas fa-angle-right"></i>
                            </a>
                            <a onclick="alteraPaginaHolerite('final')" class="btn btn-outline-danger" title="Última Página">
                                <i class="fas fa-step-forward"></i>
                            </a>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!-- PONTO -->
        <div class="tab-pane fade" id="ponto-tab-pane" role="tabpanel" aria-labelledby="ponto-tab" tabindex="0">
            <div class="row">
                <div class="col">
                    <div class="table-responsive tableFixHead mb-3" id="table-scroll-ponto">
                        <table class="table table-sm table-bordered mb-0" id="TabelaPonto">
                            <thead class="text-center">
                                <tr class="bg-dark text-white">
                                    <th scope="col">Situação</th>
                                    <th scope="col">Data</th>
                                    <th scope="col">Download</th>
                                </tr>
                            </thead>
                            <tbody>
                                <?php if (!empty($this->view->pontos)): ?>
                                    <?php foreach ($this->view->pontos as $ponto): ?>
                                        <tr>
                                            <td class="text-center">
                                                <span class="<?= $ponto['Ponto_Lido'] ? 'text-success' : 'text-danger' ?>">
                                                    <?= $ponto['Ponto_Lido'] ? 'Visualizado' : 'Não visualizado' ?>
                                                </span>
                                            </td>
                                            <td class="text-center"><?= $ponto['Ponto_Data'] ?></td>
                                            <td class="text-center">
                                                <a href="/PDF/ponto/<?= $ponto['Ponto_PDF'] ?>.pdf"
                                                    class="btn btn-primary btn-sm" target="_blank">
                                                    <i class="bi bi-download"></i> Download
                                                </a>
                                            </td>
                                        </tr>
                                    <?php endforeach; ?>
                                <?php else: ?>
                                    <tr>
                                        <td colspan="3" class="text-center text-danger">Nenhum ponto chegou na view!</td>
                                    </tr>
                                <?php endif; ?>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Paginação Ponto -->
                    <div class="d-flex justify-content-between align-items-center flex-wrap">
                        <div>
                            <small>Página <?= $this->view->paginaPonto ?> de <?= $this->view->totalPaginasPonto ?></small>
                        </div>

                        <div class="form-group mb-2">
                            <select class="form-control" onchange="mudaPaginaPonto(this.value)">
                                <?php for($i = 1; $i <= $this->view->totalPaginasPonto; $i++): ?>
                                    <option value="<?= $i ?>" <?= $i == $this->view->paginaPonto ? 'selected' : '' ?>>
                                        <?= $i ?>
                                    </option>
                                <?php endfor; ?>
                            </select>
                        </div>

                        <div class="btn-group mb-2" role="group">
                            <a onclick="alteraPaginaPonto('inicio')" class="btn btn-outline-danger" title="Primeira Página">
                                <i class="fas fa-step-backward"></i>
                            </a>
                            <a onclick="alteraPaginaPonto(-1)" class="btn btn-outline-primary" title="Página Anterior">
                                <i class="fas fa-angle-left"></i> Anterior
                            </a>
                            <a onclick="alteraPaginaPonto(1)" class="btn btn-outline-primary" title="Próxima Página">
                                Próximo <i class="fas fa-angle-right"></i>
                            </a>
                            <a onclick="alteraPaginaPonto('final')" class="btn btn-outline-danger" title="Última Página">
                                <i class="fas fa-step-forward"></i>
                            </a>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!-- COMISSÃO -->
        <div class="tab-pane fade" id="comissao-tab-pane" role="tabpanel" aria-labelledby="comissao-tab" tabindex="0">
            <div class="row">
                <div class="col">
                    <div class="table-responsive tableFixHead mb-3" id="table-scroll-Comissao">
                        <table class="table table-sm table-bordered mb-0" id="TabelaComissao">
                            <thead class="text-center">
                                <tr class="bg-dark text-white">
                                    <th scope="col">Situação</th>
                                    <th scope="col">Data</th>
                                    <th scope="col">Download</th>
                                </tr>
                            </thead>
                            <tbody>
                                <?php if (!empty($this->view->comissaos)): ?>
                                    <?php foreach ($this->view->comissaos as $comissao): ?>
                                        <tr>
                                            <td class="text-center">
                                                <span class="<?= $comissao['Comissao_Lido'] ? 'text-success' : 'text-danger' ?>">
                                                    <?= $comissao['Comissao_Lido'] ? 'Visualizado' : 'Não visualizado' ?>
                                                </span>
                                            </td>
                                            <td class="text-center"><?= $comissao['Comissao_Data'] ?></td>
                                            <td class="text-center">
                                                <a href="/PDF/comissao/<?= $comissao['Comissao_PDF'] ?>.pdf"
                                                    class="btn btn-primary btn-sm" target="_blank">
                                                    <i class="bi bi-download"></i> Download
                                                </a>
                                            </td>
                                        </tr>
                                    <?php endforeach; ?>
                                <?php else: ?>
                                    <tr>
                                        <td colspan="3" class="text-center text-danger">Nenhum Comissão chegou na view!</td>
                                    </tr>
                                <?php endif; ?>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Paginação Comissão -->
                    <div class="d-flex justify-content-between align-items-center flex-wrap">
                        <div>
                            <small>Página <?= $this->view->paginaComissao ?> de <?= $this->view->totalPaginasComissao ?></small>
                        </div>

                        <div class="form-group mb-2">
                            <select class="form-control" onchange="mudaPaginaComissao(this.value)">
                                <?php for($i = 1; $i <= $this->view->totalPaginasComissao; $i++): ?>
                                    <option value="<?= $i ?>" <?= $i == $this->view->paginaComissao ? 'selected' : '' ?>>
                                        <?= $i ?>
                                    </option>
                                <?php endfor; ?>
                            </select>
                        </div>

                        <div class="btn-group mb-2" role="group">
                            <a onclick="alteraPaginaComissao('inicio')" class="btn btn-outline-danger" title="Primeira Página">
                                <i class="fas fa-step-backward"></i>
                            </a>
                            <a onclick="alteraPaginaComissao(-1)" class="btn btn-outline-primary" title="Página Anterior">
                                <i class="fas fa-angle-left"></i> Anterior
                            </a>
                            <a onclick="alteraPaginaComissao(1)" class="btn btn-outline-primary" title="Próxima Página">
                                Próximo <i class="fas fa-angle-right"></i>
                            </a>
                            <a onclick="alteraPaginaComissao('final')" class="btn btn-outline-danger" title="Última Página">
                                <i class="fas fa-step-forward"></i>
                            </a>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!-- INFORME DE RENDIMENTO -->
        <div class="tab-pane fade" id="informederendimento-tab-pane" role="tabpanel" aria-labelledby="informederendimento-tab" tabindex="0">
            <div class="row">
                <div class="col">
                    <div class="table-responsive tableFixHead mb-3" id="table-scroll-InformeDeRendimento">
                        <table class="table table-sm table-bordered mb-0" id="TabelaInformeDeRendimento">
                            <thead class="text-center">
                                <tr class="bg-dark text-white">
                                    <th scope="col">Situação</th>
                                    <th scope="col">Data</th>
                                    <th scope="col">Download</th>
                                </tr>
                            </thead>
                            <tbody>
                                <?php if (!empty($this->view->informederendimentos)): ?>
                                    <?php foreach ($this->view->informederendimentos as $informederendimento): ?>
                                        <tr>
                                            <td class="text-center">
                                                <span class="<?= $informederendimento['Rendimentos_Lido'] ? 'text-success' : 'text-danger' ?>">
                                                    <?= $informederendimento['Rendimentos_Lido'] ? 'Visualizado' : 'Não visualizado' ?>
                                                </span>
                                            </td>
                                            <td class="text-center"><?= $informederendimento['Rendimentos_Data'] ?></td>
                                            <td class="text-center">
                                                <a href="/PDF/informederendimento/<?= $informederendimento['Rendimentos_PDF'] ?>.pdf"
                                                    class="btn btn-primary btn-sm" target="_blank">
                                                    <i class="bi bi-download"></i> Download
                                                </a>
                                            </td>
                                        </tr>
                                    <?php endforeach; ?>
                                <?php else: ?>
                                    <tr>
                                        <td colspan="3" class="text-center text-danger">Nenhum Informe De Rendimento chegou na view!</td>
                                    </tr>
                                <?php endif; ?>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Paginação Rendimentos -->
                    <div class="d-flex justify-content-between align-items-center flex-wrap">
                        <div>
                            <small>Página <?= $this->view->paginaRendimentos ?> de <?= $this->view->totalPaginasRendimentos ?></small>
                        </div>

                        <div class="form-group mb-2">
                            <select class="form-control" onchange="mudaPaginaRendimentoso(this.value)">
                                <?php for($i = 1; $i <= $this->view->totalPaginasRendimentos; $i++): ?>
                                    <option value="<?= $i ?>" <?= $i == $this->view->paginaRendimentos ? 'selected' : '' ?>>
                                        <?= $i ?>
                                    </option>
                                <?php endfor; ?>
                            </select>
                        </div>

                        <div class="btn-group mb-2" role="group">
                            <a onclick="alteraPaginaRendimentos('inicio')" class="btn btn-outline-danger" title="Primeira Página">
                                <i class="fas fa-step-backward"></i>
                            </a>
                            <a onclick="alteraPaginaRendimentos(-1)" class="btn btn-outline-primary" title="Página Anterior">
                                <i class="fas fa-angle-left"></i> Anterior
                            </a>
                            <a onclick="alteraPaginaRendimentos(1)" class="btn btn-outline-primary" title="Próxima Página">
                                Próximo <i class="fas fa-angle-right"></i>
                            </a>
                            <a onclick="alteraPaginaRendimentos('final')" class="btn btn-outline-danger" title="Última Página">
                                <i class="fas fa-step-forward"></i>
                            </a>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        
    </div>
</div>

<script>
/* HOLERITE */
function mudaPaginaHolerite(pagina) {
    window.location.href = "?pagina_holerite=" + pagina + "&pagina_ponto=<?= $this->view->paginaPonto ?>";
}
function alteraPaginaHolerite(valor) {
    let paginaAtual = <?= $this->view->paginaHolerite ?>;
    let totalPaginas = <?= $this->view->totalPaginasHolerite ?>;
    let novaPagina = paginaAtual;

    if (valor === 'inicio') novaPagina = 1;
    else if (valor === 'final') novaPagina = totalPaginas;
    else novaPagina = paginaAtual + valor;

    if (novaPagina < 1) novaPagina = 1;
    if (novaPagina > totalPaginas) novaPagina = totalPaginas;

    mudaPaginaHolerite(novaPagina);
}

/* PONTO */
function mudaPaginaPonto(pagina) {
    window.location.href = "?pagina_holerite=<?= $this->view->paginaHolerite ?>&pagina_ponto=" + pagina;
}
function alteraPaginaPonto(valor) {
    let paginaAtual = <?= $this->view->paginaPonto ?>;
    let totalPaginas = <?= $this->view->totalPaginasPonto ?>;
    let novaPagina = paginaAtual;

    if (valor === 'inicio') novaPagina = 1;
    else if (valor === 'final') novaPagina = totalPaginas;
    else novaPagina = paginaAtual + valor;

    if (novaPagina < 1) novaPagina = 1;
    if (novaPagina > totalPaginas) novaPagina = totalPaginas;

    mudaPaginaPonto(novaPagina);
}

/* COMISSÃO */
function mudaPaginaComissao(pagina) {
    window.location.href = "?pagina_comissao=<?= $this->view->paginaComissao ?>&pagina_comissao=" + pagina;
}
function alteraPaginaComissao(valor) {
    let paginaAtual = <?= $this->view->paginaComissao ?>;
    let totalPaginas = <?= $this->view->totalPaginasComissao ?>;
    let novaPagina = paginaAtual;

    if (valor === 'inicio') novaPagina = 1;
    else if (valor === 'final') novaPagina = totalPaginas;
    else novaPagina = paginaAtual + valor;

    if (novaPagina < 1) novaPagina = 1;
    if (novaPagina > totalPaginas) novaPagina = totalPaginas;

    mudaPaginaComissao(novaPagina);
}

/* Rendimentos */
function mudaPaginaRendimentos(pagina) {
    window.location.href = "?pagina_rendimentos=" + pagina
        + "&pagina_holerite=<?= $this->view->paginaHolerite ?>"
        + "&pagina_ponto=<?= $this->view->paginaPonto ?>"
        + "&pagina_comissao=<?= $this->view->paginaComissao ?>";
}

function alteraPaginaRendimentos(valor) {
    let paginaAtual = <?= $this->view->paginaRendimentos ?>;
    let totalPaginas = <?= $this->view->totalPaginasRendimentos ?>;
    let novaPagina = paginaAtual;

    if (valor === 'inicio') novaPagina = 1;
    else if (valor === 'final') novaPagina = totalPaginas;
    else novaPagina = paginaAtual + valor;

    if (novaPagina < 1) novaPagina = 1;
    if (novaPagina > totalPaginas) novaPagina = totalPaginas;

    mudaPaginaRendimentos(novaPagina);
}

// Salva a aba ativa
document.querySelectorAll('#myTab button[data-bs-toggle="tab"]').forEach(tab => {
    tab.addEventListener('shown.bs.tab', function (event) {
        localStorage.setItem('abaAtiva', event.target.id);
    });
});

// Ao carregar a página, ativa a aba salva
window.addEventListener('DOMContentLoaded', function () {
    let abaAtiva = localStorage.getItem('abaAtiva');
    if (abaAtiva) {
        let tabTrigger = new bootstrap.Tab(document.getElementById(abaAtiva));
        tabTrigger.show();
    }
});

</script>
